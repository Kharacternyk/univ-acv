### Пошуковий рушій для мультфільму Minuscule

Рушій доступний за посиланням https://kharacternyk--minuscoogle-serve.modal.run/

Може знадобитись кілька хвилин для першого запуску сторінки після тривалого часу без запитів.

Індексування відбувається у файлі [`index.py`](./index.py).
Відео у форматі `webm` завантажуються через об'єкт `torchvision.datasets.DatasetFolder`,
після чого створюється `torchcodec.decoders.VideoDecoder`.
Декодер декодує щопівсекундні кадри,
які батчами по 256 обробляються моделлю `clip.load("ViT-B/32")`.

Отримані ембедінги L2-нормалізуються та кластеризуються через `sklearn.cluster.HDBSCAN`
(використовується косинусна відстань).
Ідея полягає в тому, щоб не втрачати інформацію з ембедингів шляхом простого усереднення,
і при цьому не зберігати в індексі кожен кадр.
Таким чином, відео репрезентується набором медоїдів із змінної кількості кластерів.
На практиці виходить, що середній розмір кластера перебуває в межах 5-10 секунд
(мінімальний розмір для HDBSCAN виставляється 5 кадрів, тобто 2,5 секунди).

При пошуку ([`search.py`](./search.py))
обчислюються ймовірності належності текстового ембедінгу до кожного кластеру
ембедінгів кадрів кожного відео шляхом одного матричного множення для знаходження
косинусної відстані до медоїдів та `softmax`,
після чого для кожного відео обчислюються сума ймовірності для його кластерів.
